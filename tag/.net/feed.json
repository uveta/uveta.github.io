{
    "version": "https://jsonfeed.org/version/1",
    "title": "Uveta's blog • All posts by \".net\" tag",
    "description": "Uveta's blog about all things Azure",
    "home_page_url": "https://www.uveta.io",
    "items": [
        {
            "id": "https://www.uveta.io/categories/blog/ahaaas-august-2020/",
            "url": "https://www.uveta.io/categories/blog/ahaaas-august-2020/",
            "title": "Ahaaas! - August 2020",
            "date_published": "2020-09-05T07:32:56.000Z",
            "content_html": "<html><head></head><body><img src=\"/categories/blog/ahaaas-august-2020/cartoon-1294877.png\" class=\"\" title=\"Eureka\">\n\n<p>New month, new exciting moments from my life as a developer. I hope you will enjoy reading about these flashes of clarity, that come suddenly after solving unfamiliar problems. Or as I like to call them - Ahaaas!</p>\n<span id=\"more\"></span>\n\n<h3 id=\"NET\"><a href=\"#NET\" class=\"headerlink\" title=\".NET\"></a>.NET</h3><ul>\n<li><p>Instead of using <code>BlockingCollection</code>, recommended implementation of producer/consumer pattern for .NET Core should utilize <a href=\"https://devblogs.microsoft.com/dotnet/an-introduction-to-system-threading-channels/\">Channels</a>. Besides granting full control of number of consumers, it is completely asynchronous and does not lead to thread blocking.</p>\n</li>\n<li><p>If writing a custom ASP.NET Core middleware, pay attention how scoped services are injected. As middlewares are registered as singletons, scoped services cannot be injected via constructor <a href=\"https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware/write#middleware-dependencies\">https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware/write#middleware-dependencies</a>.</p>\n</li>\n<li><p>There is no simple way to resolve implementations of <code>IHostedService</code> or <code>BackgroundService</code> from DI container. Event though hosted services should not be injected into other services, if you absolutely need to, you can do one of the following (ordered by recommendation, from “yes, please” to “why would you do that”):</p>\n<ul>\n<li>Do not implement <code>IHostedService</code> directly, but create a hosted wrapper which injects your service and activates it on start; inject service elsewhere and not the hosted wrapper.</li>\n<li>Register service both as hosted service and a singleton; same instance will be resolved when injecting.</li>\n<li>Inject <code>IEnumerable&lt;IHostedService&gt;</code> and use LINQ to find instance by concrete type.</li>\n</ul>\n</li>\n<li><p>Use the following pattern if you require your event publisher to wait for asynchronous consumers. This can prove useful in case you are testing event driven units and require consumers to complete execution before code following publisher invocation continues. Another example is having application shutdown event, which could wait for consumers before exiting gracefully. Source code was obtained from <a href=\"https://stackoverflow.com/\">Stack Overflow</a> but for the life of me I could not find the original question again, hence no direct link :(</p>\n</li>\n</ul>\n<figure class=\"highlight cs hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">event</span> Func&lt;T, Task&gt; ItemQueued;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">async</span> Task <span class=\"hljs-title\">OnNewItemAsync</span>(<span class=\"hljs-params\">T item</span>)</span></span><br><span class=\"line\">{</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (ItemQueued <span class=\"hljs-keyword\">is</span> <span class=\"hljs-literal\">null</span>) <span class=\"hljs-keyword\">return</span>;</span><br><span class=\"line\">    Func&lt;T, Task&gt; handler = ItemQueued;</span><br><span class=\"line\">    Delegate[] invocationList = handler.GetInvocationList();</span><br><span class=\"line\">    Task[] handlerTasks = <span class=\"hljs-keyword\">new</span> Task[invocationList.Length];</span><br><span class=\"line\">    <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-built_in\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; invocationList.Length; i++)</span><br><span class=\"line\">    {</span><br><span class=\"line\">      handlerTasks[i] = ((Func&lt;T, Task&gt;)invocationList[i])(item);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"hljs-keyword\">await</span> Task.WhenAll(handlerTasks);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<ul>\n<li><p>When developing server side Blazor application, HTML markup cannot be changed without having to rebuild the whole application. As this is something naturally supported by other SPA frameworks, you can achieve similar behaviour by running application with <em>dotnet watch run</em>. It will react to any change in source files, re-build and re-run application. It is not a perfect method in any way, but removes the need to manually stop, build and run every time.</p>\n</li>\n<li><p>If you use Visual Studio you can have <a href=\"https://chrissainty.com/get-some-sass-into-your-blazor-app/\">Sass in Blazor</a>! It can be achieved by installing an extension and including a specific NuGet package to projects with <em>.scss</em> files. In VS Code, you can use <a href=\"https://github.com/ritwickdey/vscode-live-sass-compiler\">Live Sass Compiler</a> extension.</p>\n</li>\n<li><p>Having trouble finding NuGet package storage and caches on your PC? Just use <em>dotnet nuget locals all –list</em> to show all relevant paths. Documentation about additional commands for managing NuGet sources can be found <a href=\"https://docs.microsoft.com/en-us/nuget/consume-packages/managing-the-global-packages-and-cache-folders\">here</a>.</p>\n</li>\n<li><p>Selective testing using <em>dotnet test --filter</em> argument <a href=\"https://docs.microsoft.com/en-us/dotnet/core/testing/selective-unit-tests?pivots=xunit\">https://docs.microsoft.com/en-us/dotnet/core/testing/selective-unit-tests?pivots=xunit</a>.</p>\n</li>\n<li><p>Even though health checks were introduced in ASP.NET Core 2.2, there are certain issues with initial implementation. Majority of them, mostly related to <code>IHealthCheckPublisher</code> host service and options, were fixed in version 3.0. But, if you are still using 2.2, you might want to check <a href=\"https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/health-checks?view=aspnetcore-2.2#health-check-publisher-1\">issue description and workarounds</a>.</p>\n</li>\n</ul>\n<h3 id=\"Azure\"><a href=\"#Azure\" class=\"headerlink\" title=\"Azure\"></a>Azure</h3><ul>\n<li><p>Even if you don’t think you’d need it, I recommend turning on soft delete on all blob storages, for at least a period of 7 days. It is one of few features that can protect you from accidental blob removal, as blob storage is currently not supported by Azure Backup. More details on how to enable this option can be found in <a href=\"https://docs.microsoft.com/en-us/azure/storage/blobs/soft-delete-enable\">official documentation</a>.</p>\n</li>\n<li><p>In order to test timer triggered Azure Functions, Portal can be used to manually invoke them. From the blade of your Function App, go to Functions, select specific function by name, go to Code + Test and click Test\\Run button. Function will be immediately invoked and you can even check its log output.</p>\n</li>\n<li><p>If you used official template to deploy Elasticsearch cluster to Azure, be sure to replace data disks on each node. They are deployed as standard HDD by default, but I would recommend using standard or, even better, premium SSD. The price difference is negligible, if you are not using very large disks. Obvious benefit is having query response time reduced by approximately 50%. To replace the disk, simply power down node VM, select data disk from Disks blade and switch it to SSD directly from Portal. Repeat for each node in your cluster.</p>\n</li>\n<li><p>When consuming Azure Service Bus queues/subscriptions, make sure MaxAutoRenewDuration is greater than LockDuration. As best practice, you should leave LockDuration to its default value of 1 minute, and set MaxAutoRenewDuration to maximum time it can take your consumer to process 1 message. If you want to learn more on how Service Bus consumers handle message locking, check <a href=\"https://stackoverflow.com/a/60381046\">this great answer on Stack Overflow</a>.</p>\n</li>\n</ul>\n<h3 id=\"Containers\"><a href=\"#Containers\" class=\"headerlink\" title=\"Containers\"></a>Containers</h3><ul>\n<li><p>Found a great online workshop showcasing Docker and Kubernetes for .NET developers <a href=\"https://dak4.net/\">https://dak4.net</a>.</p>\n</li>\n<li><p>Virtual Kubelet for Azure Container Instances does not support pod liveness, readiness or startup checks <a href=\"https://github.com/virtual-kubelet/azure-aci\">https://github.com/virtual-kubelet/azure-aci</a>. This can seriously limit its usage in production scenarios, as Kubernetes service will not be able to determine pod health. I recommend using ACI kubelet only for bursts of short-running operations. As a bonus piece of information, you can have only 100 ACI instances per subscription, which means virtual kubelet can handle maximum of 100 pods.</p>\n</li>\n<li><p>At the moment it is not possible to turn off performance monitoring for Azure Kubernetes Service. Collection of various logs can be tweaked, but performance telemetry cannot be configured in any way. This can result in not so small charges for data ingested in Log Analytics, especially if running lots of pods, as telemetry is gathered for every single one of them. Only option is to <a href=\"https://docs.microsoft.com/en-us/azure/azure-monitor/insights/container-insights-optout\">disable monitoring altogether</a>.</p>\n</li>\n</ul>\n<h3 id=\"Miscellaneous\"><a href=\"#Miscellaneous\" class=\"headerlink\" title=\"Miscellaneous\"></a>Miscellaneous</h3><ul>\n<li><p>Ever wished you could develop in emojis? Now you can <a href=\"https://www.emojicode.org/\">https://www.emojicode.org/</a>.</p>\n</li>\n<li><p>Great explanation of Linux filesystem and usage of various directories found in root path <a href=\"https://www.howtogeek.com/117435/htg-explains-the-linux-directory-structure-explained/\">https://www.howtogeek.com/117435/htg-explains-the-linux-directory-structure-explained/</a>. If you ever wondered what are /bin, /etc, /usr directories used for, look no further.</p>\n</li>\n<li><p>GitHub is launching its own <a href=\"https://github.blog/2020-09-01-introducing-github-container-registry/\">Container Registry</a>! At the moment, they are just missing their own Kubernetes offering to close development and deployment circle.</p>\n</li>\n</ul>\n</body></html>",
            "tags": [
                "azure",
                "advanced",
                ".net",
                "csharp",
                "containers"
            ]
        },
        {
            "id": "https://www.uveta.io/categories/blog/ahaaas-july-2020/",
            "url": "https://www.uveta.io/categories/blog/ahaaas-july-2020/",
            "title": "Ahaaas! - July 2020",
            "date_published": "2020-07-25T17:12:39.000Z",
            "content_html": "<html><head></head><body><img src=\"/categories/blog/ahaaas-july-2020/bulb.png\" class=\"\" title=\"Eureka\">\n\n<p>In fast paced technology world, developers discover new insights practically on a daily level. Surely you have experienced these moments of almost divine wisdom, ending with “Now I know xyz can do that” or “I have to be aware of xyz” or “Eureka!”. I have recorded my moments of clarity, or Ahaaas as I call them, hoping that some of them will prove useful to you, whether you’d be dealing with .NET development, Azure or Docker.</p>\n<span id=\"more\"></span>\n\n<h3 id=\"NET\"><a href=\"#NET\" class=\"headerlink\" title=\".NET\"></a>.NET</h3><ul>\n<li>Mocking authentication in ASP.NET Core 3.0 integration tests <a href=\"https://docs.microsoft.com/en-us/aspnet/core/test/integration-tests#mock-authentication\">https://docs.microsoft.com/en-us/aspnet/core/test/integration-tests#mock-authentication</a></li>\n<li>Even though ASP.NET Core <code>IConfiguration</code> entry names are case-insensitive, <code>ConfigurationBinder.Bind()</code> method is not and property name casing does matter. Prefer using <a href=\"https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.dependencyinjection.optionsconfigurationservicecollectionextensions.configure\">Configure()</a> options extension method to bind configuration sections to option types.</li>\n<li>Be careful when using array values in <code>IConfiguration</code> data sources, especially if you consider overriding with environment specific configurations <a href=\"https://rimdev.io/avoiding-aspnet-core-configuration-pitfalls-with-array-values/\">https://rimdev.io/avoiding-aspnet-core-configuration-pitfalls-with-array-values/</a></li>\n<li>If you cannot rely on your reverse proxy, it is possible to add client and IP rate limiting to ASP.NET Core. Source code and installation instructions are available at <a href=\"https://github.com/stefanprodan/AspNetCoreRateLimit\">https://github.com/stefanprodan/AspNetCoreRateLimit</a>. Remember, however, that Kestrel should not be used as a public facing web server.</li>\n<li>Controller input model validation can be automated using <code>[ApiController]</code> attribute and annotations from <code>DataAnnotations</code> namespace <a href=\"https://docs.microsoft.com/en-us/aspnet/core/mvc/models/validation\">https://docs.microsoft.com/en-us/aspnet/core/mvc/models/validation</a></li>\n<li>When using <code>[DataMember]</code> attribute to annotate serialization model properties, do not forget to add <code>[DataContract]</code> to  enclosing type as well. Most of traditional JSON serializers, such as Newtonsoft and Jil, honor property attributes, but expect type to be annotated as well. <code>System.Text.Json.JsonSerializer</code> surprisingly does not utilize attributes from <code>System.Runtime.Serialization</code> namespace and uses its own <a href=\"https://docs.microsoft.com/en-us/dotnet/standard/serialization/system-text-json-how-to#customize-individual-property-names\">annotations</a></li>\n<li>Cool portability tool from .NET to .NET core comes from, you wouldn’t believe it, AWS team. More details <a href=\"https://aws.amazon.com/blogs/aws/announcing-the-porting-assistant-for-net/\">https://aws.amazon.com/blogs/aws/announcing-the-porting-assistant-for-net/</a></li>\n<li><code>System.Net.Mail.SmtpClient</code> is obsolete for some time; recommended alternative is <a href=\"https://github.com/jstedfast/MailKit\">MailKit</a></li>\n<li><code>IApplicationLifetime</code> service is obsolete from .Net Core 3.0. If you utilize generic host, use <code>IHostApplicationLifetime</code> instead <a href=\"https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.hosting.iapplicationlifetime\">https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.hosting.iapplicationlifetime</a></li>\n<li>Imagine you have a concrete type implementing two different interfaces. Now imagine you register this type for each interface as a singleton in DI container. When resolving each interface, you will end up with a different instances, i.e. .NET core DI container will create two instances instead of sharing single one.</li>\n<li>If you are looking for Blazor components that you can use for commercial projects, Syncfusion offers a handful via their community license <a href=\"https://www.syncfusion.com/products/communitylicense\">https://www.syncfusion.com/products/communitylicense</a></li>\n</ul>\n<h3 id=\"Azure\"><a href=\"#Azure\" class=\"headerlink\" title=\"Azure\"></a>Azure</h3><ul>\n<li>If you use sessions with Azure Service Bus, be sure to assign session identifier to messages before sending them. Service Bus will not complain if session is missing on enqueue, but will make hell for consumers on delivery and practically keep messages in queue and attempt to deliver them, until expired.</li>\n<li>You can use Azure Log Analytics to collect custom virtual machine logs <a href=\"https://docs.microsoft.com/en-us/azure/azure-monitor/platform/data-sources-custom-logs\">https://docs.microsoft.com/en-us/azure/azure-monitor/platform/data-sources-custom-logs</a>. In Portal, open your  Log Analytics workspace and go to Advanced Settings-&gt;Data-&gt;Custom Logs. You can also collect Windows Event and IIS Logs, as well as Linux Syslog, in a similar fashion.</li>\n<li>Data sampling, configured in Application Insight’s Usage and Estimated Costs, has no effect if you are using ASP.NET core applications without modifying telemetry sampling configuration. Ingested data can significantly increase costs, especially if Azure Functions are used, so use Daily Cap setting to get notified if the amount ingested passes the limit.</li>\n<li>Microsoft Q&amp;A is generally available and should help you find any technical information regarding Azure services <a href=\"https://docs.microsoft.com/en-us/answers/products/\">https://docs.microsoft.com/en-us/answers/products/</a></li>\n</ul>\n<h3 id=\"Miscellaneous\"><a href=\"#Miscellaneous\" class=\"headerlink\" title=\"Miscellaneous\"></a>Miscellaneous</h3><ul>\n<li>Nice overview of most commonly used open source licenses, with usage restrictions <a href=\"https://choosealicense.com/\">https://choosealicense.com</a></li>\n<li>Steve Dunn used Blazor to recreate original Pacman <a href=\"http://pacmanblazor.azurewebsites.net/\">http://pacmanblazor.azurewebsites.net</a>. With a little bit of JS interop, he was able to demonstrate potential of client-side Blazor running on WebAssembly. Source code can be found on <a href=\"https://github.com/SteveDunn/PacManBlazor\">Github</a></li>\n<li>Postman automatically converts POST requests if it receives a 301 redirect status code. In this situation, it drops any request content and issues a GET request to redirecting location without any body data. This can lead to trouble, as user is never notified of such change during request execution. To avoid such issues, better turn off automatic redirects in Postman settings.</li>\n<li>Elasticsearch .NET client version 7.1.0 seems to have issues when running on .NET core 3.0. Updating client to latest version (7.8.0 at the moment of writing) seems to help.</li>\n</ul>\n</body></html>",
            "tags": [
                "azure",
                "advanced",
                ".net",
                "csharp",
                "containers"
            ]
        }
    ]
}